<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OptiMaxcs</title>
  <style>
    body {
      margin: 0;
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #ffffff;
      color: #222;
      line-height: 1.6;
    }

    header {
      background: #ffffff;
      color: #111;
      padding: 50px 20px;
      text-align: center;
      border-bottom: 2px solid #eaeaea;
    }

    header h1 {
      margin: 0;
      font-size: 2.8em;
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    main {
      max-width: 900px;
      margin: 60px auto;
      padding: 0 20px;
      text-align: center;
    }

    footer {
      background: #f9f9f9;
      text-align: center;
      padding: 25px;
      font-size: 0.9em;
      color: #777;
      border-top: 2px solid #eaeaea;
    }

    

    #chatbot {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 9999;
    }

    #chatbot-header {
      background: #111;
      color: #fff;
      padding: 12px;
      font-weight: bold;
      text-align: center;
    }

    #chatbot-messages {
      padding: 10px;
      height: 260px;
      overflow-y: auto;
      font-size: 0.9em;
    }

    .msg {
      margin-bottom: 10px;
    }

    .bot {
      color: #111;
    }

    .user {
      color: #555;
      text-align: right;
    }

    #chatbot-input {
      display: flex;
      border-top: 1px solid #ddd;
    }

    #chatbot-input input {
      flex: 1;
      padding: 10px;
      border: none;
      outline: none;
    }

    #chatbot-input button {
      background: #111;
      color: #fff;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
    }

    #chat-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #111;
      color: #fff;
      padding: 14px 18px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 9998;
    }

    .warning {
      color: #c0392b;
      font-size: 0.85em;
      text-align: center;
    }
  </style>
</head>
<body>

<header>
  <h1>OptiMaxcs</h1>
</header>

<main>
  <h2>Optimising for free</h2>
  <p>OptiMaxcs is upcoming software what will give all intel mac users more power.</p>
</main>

<footer>
  <p>OptiMaxcs</p>
</footer>


<div id="chat-toggle">ðŸ’¬</div>

<div id="chatbot">
  <div id="chatbot-header">OptiMaxcs Support</div>
  <div id="chatbot-messages"></div>
  <div id="chatbot-input">
    <input id="chat-input" placeholder="Type here..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const API = "/api";
let sessionId = null;
let userName = null;

const chat = document.getElementById("chatbot");
const messages = document.getElementById("chatbot-messages");
const input = document.getElementById("chat-input");

document.getElementById("chat-toggle").onclick = () => {
  chat.style.display = chat.style.display === "flex" ? "none" : "flex";
};

function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerText = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

async function startSession() {
  const res = await fetch(API + "/start", { method: "POST" });
  const data = await res.json();
  sessionId = data.session_id;
  addMessage(data.message, "bot");
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  input.value = "";

  addMessage(text, "user");

  if (!userName) {
    userName = text;
    addMessage(`Nice to meet you ${userName}! How can I help?`, "bot");
    return;
  }

  const res = await fetch(API + "/support", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      session_id: sessionId,
      name: userName,
      text: text
    })
  });

  const data = await res.json();
  addMessage(data.response, "bot");

  if (data.warning) {
    const w = document.createElement("div");
    w.className = "warning";
    w.innerText = data.warning;
    messages.appendChild(w);
  }
}

window.addEventListener("beforeunload", () => {
  if (sessionId) {
    navigator.sendBeacon(
      API + "/end-session",
      JSON.stringify({ session_id: sessionId })
    );
  }
});

startSession();
</script>

</body>
</html>
